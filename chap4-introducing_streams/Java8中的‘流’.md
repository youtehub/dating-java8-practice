# Java8中的‘流’

原创 翎野君 [翎驿](http://www.cnblogs.com/lingyejun) *2020-01-24*

**翎野君**/文




## 流的概念



### 1.流是什么

流是Java API的新成员，它允许你以声明性方式处理数据集合(通过查询语句来表达，而不是临时编写一个实现)。就现在来说，我们可以把它们看成遍历数据集的高级迭代器。



代码：按价格排序后得到手机名称列表



使用新的流式方法有几个显而易见的好处。

- 代码是以声明性方式写的:说明想要完成什么而不是说明如何实现一个操作(如利用循环和if条件等控制流语句)。
- 我们可以把几个基础操作链接起来，来表达复杂的数据处理流水线(在filter后面接上 sorted、map和collect操作，如图4-1所示)，同时保持代码清晰可读。filter的结果 被传给了sorted方法，再传给map方法，最后传给collect方法。
![img](https://img-blog.csdnimg.cn/2021021416572616.png)


### 2.流简介

‘流’的简单定义就是“从支持数据处理操作的源生成的元素序列”。



- 元素序列——就像集合一样，流也提供了一个接口，可以访问特定元素类型的一组有序值。因为集合是数据结构，所以它的主要目的是以特定的时间/空间复杂度存储和访问元素(如ArrayList与LinkedList)。但流的目的在于表达计算，比如你前面见到的 filter、sorted和map。集合讲的是数据，流讲的是计算。
- 源——流会使用一个提供数据的源，如集合、数组或输入/输出资源。请注意，从有序集 合生成流时会保留原有的顺序。由列表生成的流，其元素顺序与列表一致。
- 数据处理操作——流的数据处理功能支持类似于数据库的操作，以及函数式编程语言中的常用操作，如filter、map、reduce、find、match、sort等。流操作可以顺序执行，也可并行执行。



### 3.流的特点

流的两个重要特点

- 流水线——很多流操作本身会返回一个流，这样多个操作就可以链接起来，形成一个大的流水线。流水线的操作可以看作对数据源进行数据库式查询。
- 内部迭代——与使用迭代器显式迭代的集合不同，流的迭代操作是在背后进行的。


## 流与集合



### 1.流和集合之间的差异

集合与流之间的差异在于什么时候进行计算。

- 集合是一个内存中的数据结构，它包含数据结构中目前所有的值，集合中的每个元素都得先算出来才能添加到集合中。即，可以往集合里加东西或者删东西，但是不管什么时候，集合中的每个元素都是放在内存里的，元素都得先算出来才能成为集合的一部分。
- 相比之下，流则是在概念上固定的数据结构(你不能添加或删除元素)，其元素则是按需计算的。 从另一个角度来说，流就像是一个延迟创建的集合:只有在消费者要求的时候才会计算值。



### 2.注意事项

请注意，和迭代器类似，**流只能遍历一次**。遍历完之后，我们就说这个流已经被消费掉了。 



### 3.遍历数据时的区别

集合和流的另一个关键区别在于它们遍历数据的方式。

使用Collection接口需要用户去做迭代(比如用for-each)，这称为外部迭代。

相反，Streams库使用内部迭代——它帮你把迭代做了，还把得到的流值存在了某个地方，我们只要给出 一个函数说要干什么就可以了。

- 使用for-each循环外部迭代
- 使用其背后的迭代器做外部迭代
- 使用流做内部迭代


![img](https://img-blog.csdnimg.cn/20210214165923617.png)



## 03.流操作



java.util.stream.Stream中的Stream接口定义了许多操作。它们可以分为两大类。 



你可以看到两类操作:

- filter、map和limit可以连成一条流水线; 
- collect触发流水线执行并关闭它。

可以连接起来的流操作称为中间操作，关闭流的操作称为终端操作。



中间操作：诸如filter或sorted等中间操作会返回另一个流。这让多个操作可以连接起来形成一个查询。更重要的是，除非流水线上触发一个终端操作，否则中间操作不会执行任何处理——它们很懒。这是因为中间操作一般都可以合并起来，在终端操作时一次性全部处理。

终端操作：终端操作会从流的流水线生成结果。其结果是任何不是流的值，比如List、Integer，或者void。



## 使用流



总而言之，流的使用一般包括三件事:

- 一个数据 (如集合)来执行一个查询;
- 一个中间操作链，形成一条流的流水线;
- 一个终端操作，执行流水线，并能生成结果。



流的流水线背后的理念类似于构建器模式。在构建器模式中有一个调用链用来设置一套配置(对流来说这就是一个中间操作链)，接着是调用built方法(对流来说就是终端操作)。

为方便起见，表4-1和表4-2总结了你前面在代码例子中看到的中间流操作和终端流操作。注意这只是总结之前代码中我们遇到的操作，并不是全部。

![img](https://img-blog.csdnimg.cn/20210214170127860.png)

## 05.小结



- 流是“从支持数据处理操作的源生成的一系列元素”。
- 流利用内部迭代:迭代通过filter、map、sorted等操作被抽象掉了。
- 流操作有两类:中间操作和终端操作。
- filter和map等中间操作会返回一个流，并可以链接在一起。可以用它们来设置一条流水线，但并不会生成任何结果。
- forEach和count等终端操作会返回一个非流的值，并处理流水线以返回结果。
- 流中的元素是按需计算的。